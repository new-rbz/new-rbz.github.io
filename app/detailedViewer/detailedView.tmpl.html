<!-- https://github.com/daneden/animate.css/blob/master/README.md -->
<style>
    .label {
        vertical-align: middle !important;
    }

    .label-warning, .label-success, .label-danger, .label-info, .label-default {
        font-size: small !important;
    }

    /*.label-info {
            font-size:small !important;
        }*/
</style>
<toaster-container toaster-options="{'time-out': 5000}"></toaster-container>
<div class="container-fixed">
    <div class="row" ng-cloak="">
        <div id="results" class="col-lg-12" style="z-index:1 !important;">
            <br />
            <div class="well">
                <div class="row">
                    <div class="col-xs-6">
                        <select class="form-control" ng-model="vm.selectedSource" ng-change="vm.handleDataSourceChange()"
                                title='Choose one of the following...'>
                            <option ng-repeat="item in vm.sources">{{item}}</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active">Avg PE {{ vm.data | weightedAverageAll:'PERatio':'MarketCapitalization':'list' | number:2  }}</li>
                        <li role="presentation">&nbsp;|Avg PEG {{ vm.data | weightedAverageAll:'PEGRatio':'MarketCapitalization':'list' | number:2  }}</li>
                        <li role="presentation" class="active">&nbsp;|Avg PB {{ vm.data | weightedAverageAll:'PriceBook':'MarketCapitalization':'list' | number:2  }}</li>
                        <li role="presentation">&nbsp;|Avg PS {{ vm.data | weightedAverageAll:'PriceSales':'MarketCapitalization':'list' | number:2  }}</li>
                        <li role="presentation" class="active">&nbsp;|Avg Div {{ vm.data | weightedAverageAll:'DividendYield':'MarketCapitalization':'list' | number:2  }}</li>
                        <li role="presentation">&nbsp;|Avg MACD50 {{ vm.data | weightedAverageAll:'PercentChangeFromFiftydayMovingAverage':'MarketCapitalization':'list' | number:2  }}</li>
                        <li role="presentation">&nbsp;|Avg MACD200 {{ vm.data | weightedAverageAll:'PercentChangeFromTwoHundreddayMovingAverage':'MarketCapitalization':'list' | number:2  }}</li>
                    </ul>
                </div>
            </div>
            <tabset type="pills">
                <tab ng-repeat="row in vm.data track by row.sector" heading="{{row.sector}}" ng-click="tabSwitch(row.sector)">
                    <div class="row col-xs-12">
                        <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation">Avg PE {{ row.list | weightedAverage:'PERatio':'MarketCapitalization' | number:2  }}</li>
                            <li role="presentation">&nbsp;|Avg PEG {{ row.list | weightedAverage:'PEGRatio':'MarketCapitalization' | number:2  }}</li>
                            <li role="presentation">&nbsp;|Avg PB {{ row.list | weightedAverage:'PriceBook':'MarketCapitalization' | number:2  }}</li>
                            <li role="presentation">&nbsp;|Avg PS {{ row.list | weightedAverage:'PriceSales':'MarketCapitalization' | number:2  }}</li>
                            <li role="presentation">&nbsp;|Avg Div {{ row.list | weightedAverage:'DividendYield':'MarketCapitalization' | number:2  }}</li>
                            <li role="presentation">&nbsp;|Avg MACD50 {{ row.list | weightedAverage:'PercentChangeFromFiftydayMovingAverage':'MarketCapitalization' | number:2  }}</li>
                            <li role="presentation">&nbsp;|Avg MACD200 {{ row.list | weightedAverage:'PercentChangeFromTwoHundreddayMovingAverage':'MarketCapitalization' | number:2  }}</li>
                        </ul>
                    </div>
                    <div class="">
                        <ul class="list-group">
                            <li ng-repeat="result in row.list track by $index">
                                <div class="row">
                                    <div class="col-xs-1">
                                        <button style="width: 100%" class="btn btn-warning" data-ng-click="vm.openTradeView(result.symbol)">TradeView</button><br />
                                        <button style="width: 100%" class="btn btn-success" data-ng-click="vm.openYahoo(result.symbol)">Yahoo</button><br />
                                        <button style="width: 100%" class="btn btn-danger" data-ng-click="vm.openGuru(result.symbol)">Guru Focus</button><br />
                                        <button style="width: 100%" class="btn btn-info" data-ng-click="vm.openFinviz(result.symbol)">Finviz</button><br />
                                    </div>
                                    <div class="col-xs-4">
                                        <img height='300' width='600' ng-src='http://finviz.com/chart.ashx?t={{result.symbol}}&ty=c&ta=1&p=d&s=l' style='vertical-align: middle !important;' />
                                    </div>
                                    <div class="col-xs-6">
                                        <span> Name:{{ result.Name | limitTo: 25 }}</span>
                                        <span>
                                            Symbol:
                                            <span class="label label-info">
                                                <a ng-click='vm.openFinviz(result.symbol)'>{{ result.symbol + (result.MarketCapitalization ? " " + result.MarketCapitalization : "") }}</a>
                                            </span>
                                        </span><br /><br />
                                        <span>
                                            Quick Evaluation:
                                            <a ng-click='vm.openYahoo(result.symbol)'>
                                                <span class="label" ng-class="vm.evaluateSeriesData(result).cssClass">
                                                    {{
                                                    (result.OneyrTargetPrice ? "(" + ((result.OneyrTargetPrice/ result.LastTradePriceOnly-1) * 100| number:0) + "% Target:" + result.OneyrTargetPrice + ", " : "(") +
                                                    "MACD50:" + result.PercentChangeFromFiftydayMovingAverage   +") "
                                                    + vm.evaluateSeriesData(result).text
                                                    }}
                                                </span>
                                            </a>
                                        </span>
                                        <br /><br />
                                        <!-- Volume -->
                                        <span>
                                            Relative Voume:
                                            <span ng-class="{
                                  'label-danger' : (result.Volume / result.AverageDailyVolume) * 100 < 50,
                                  'label-warning' : (result.Volume / result.AverageDailyVolume) * 100 >= 50 && (result.Volume / result.AverageDailyVolume) * 100 < 100,
                                  'label-success' : (result.Volume / result.AverageDailyVolume) * 100 > 100
                                  }" class="label">{{ (result.Volume / result.AverageDailyVolume) * 100 | number:0 }}%</span>
                                        </span>&nbsp;&nbsp;

                                        <span>
                                            % Change:
                                            <span ng-class="{ 'label-danger' : ((result.LastTradePriceOnly / result.PreviousClose) -1) < 0,
                                  'label-warning' : ((result.LastTradePriceOnly / result.PreviousClose) -1) >= 0 && ((result.LastTradePriceOnly / result.PreviousClose) -1) <= (3.5/100),
                                  'label-success' : ((result.LastTradePriceOnly / result.PreviousClose) -1) > (3.5/100) }"
                                                  class="label">{{ ((result.LastTradePriceOnly / result.PreviousClose) -1) * 100 | number:1 }}%</span>
                                        </span>&nbsp;&nbsp;
                                        <br /><br />
                                        <span>
                                            Regression Potential:
                                            <span ng-class="{ 'label-danger' :  ((result.YearHigh / result.LastTradePriceOnly) -1) < 0.07,
                                  'label-warning' : ((result.YearHigh / result.LastTradePriceOnly) -1) >= 0.07 && ((result.YearHigh / result.LastTradePriceOnly) -1) <= 0.2,
                                  'label-success' : ((result.YearHigh / result.LastTradePriceOnly) -1) > 0.2 }"
                                                  class="label">
                                                {{ ((result.YearHigh / result.LastTradePriceOnly) -1) * 100 | number:1  }} %
                                            </span>
                                        </span>&nbsp;&nbsp;<br />
                                        <span> Last Price: <a ng-click='vm.openGuru(result.symbol)'>{{ result.LastTradePriceOnly | currency}}</a></span>&nbsp;&nbsp;

                                        <span>Previous Close:{{ result.PreviousClose }}</span>&nbsp;&nbsp;
                                        <!--Price comparison to long-term -->

                                        <span>Short Ratio: {{ result.ShortRatio }}</span>&nbsp;&nbsp;
                                        <br /><br />
                                        
                                        <span>
                                            EPS Growth:
                                            <span ng-class="{ 'label-danger' :  ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 < 0,
                                  'label-warning' : ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 >= 0 && ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 <= 0.05,
                                  'label-success' : ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 > 0.5 }"
                                                  class="label">
                                                {{ ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 | number:2}}%
                                            </span>
                                        </span>&nbsp;&nbsp;

                                        <span>
                                            Evaluation:
                                            <span class="label label-info">
                                                {{ vm.evaluateFundamentalData(result)| number:2 }}
                                            </span>
                                        </span>&nbsp;&nbsp;
                                        <span>
                                            Buffett:
                                            <a ng-click='vm.openGuru(result.symbol)'>
                                                <span ng-class="{ 'label-danger' :  (22.5 / (result.PriceBook * result.PERatio)) * 100 < 100,
                                  'label-warning' :(22.5 / (result.PriceBook * result.PERatio)) * 100 >= 100 && (22.5 / (result.PriceBook * result.PERatio)) * 100 <= 120,
                                  'label-success' : (22.5 / (result.PriceBook * result.PERatio)) * 100 > 120 }"
                                                      class="label">
                                                    {{ (22.5 / (result.PriceBook * result.PERatio)) * 100 | number:2 }}%
                                                </span>
                                            </a>
                                        </span>&nbsp;&nbsp;<br /><br />
                                        <span>EPS:{{ result.EPSEstimateCurrentYear | number:2}}</span>&nbsp;&nbsp;


                                        <!-- Equity -->
                                        <span>
                                            PB:
                                            <span class="label"
                                                  ng-class="
                                              {
                                                'label-danger': result.PriceBook >= 4,
                                                'label-warning': result.PriceBook >= 2 && result.PriceBook < 4,
                                                'label-success': result.PriceBook <2
                                              }">{{ result.PriceBook }}</span>
                                        </span>&nbsp;&nbsp;
                                        <span>
                                            PS:
                                            <span class="label"
                                                  ng-class="
                                              {
                                              'label-info' : result.PriceSales == 0,
                                                'label-danger': result.PriceSales >= 4,
                                                'label-warning': result.PriceSales >= 2 && result.PriceSales < 4,
                                                'label-success': result.PriceSales <2 && result.PriceSales != 0
                                              }">{{ result.PriceSales }}</span>
                                        </span>&nbsp;

                                        <!-- Earnings -->
                                        <span>
                                            PE:
                                            <span class="label"
                                                  ng-class="
                                              {
                                                'label-danger': result.PERatio > 19,
                                                'label-warning': result.PERatio > 12 && result.PEGRatio <= 19,
                                                'label-success': result.PERatio <=12
                                              }">{{ result.PERatio }}</span>
                                        </span>&nbsp;&nbsp;
                                        <span>
                                            PEG:
                                            <span class="label"
                                                  ng-class="
                                              {
                                                'label-danger': result.PEGRatio > 1.75,
                                                'label-warning': result.PEGRatio > 1 && result.PEGRatio <= 1.75,
                                                'label-success': result.PEGRatio <=1 && result.PEGRatio != 0,
                                                'label-info' : result.PEGRatio == 0
                                              }">{{ result.PEGRatio }}</span>
                                        </span>
                                        
                                        <br /><br />
                                        <span>
                                            Dividend Yield:
                                            <span class="label" ng-class="{
                                              'label-info': result.DividendYield == 0,
                                              'label-danger': result.DividendYield > 0 && (result.DividendYield <=1.5 || result.DividendYield > 7),
                                              'label-warning': result.DividendYield > 1.5 && result.DividendYield < 4,
                                              'label-success': result.DividendYield >= 4 && result.DividendYield <= 7}">{{ result.DividendYield | number:2 }}</span>&nbsp;&nbsp;{{ vm.adjustDividendDate(result.ExDividendDate) }}
                                        </span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </tab>
            </tabset>
        </div>
    </div>
</div>