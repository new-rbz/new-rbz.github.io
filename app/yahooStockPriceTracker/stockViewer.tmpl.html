<!-- https://github.com/daneden/animate.css/blob/master/README.md -->
<style>
    .label {
        vertical-align: middle !important;
    }

    .label-warning, .label-success, .label-danger, .label-info, .label-default {
        font-size: medium !important;
    }

    /*.label-info {
            font-size:small !important;
        }*/
</style>
<toaster-container toaster-options="{'time-out': 5000}"></toaster-container>
<div class="container-fixed">
    <div class="row col-xs-12">
      <ul class="nav nav-tabs" role="tablist" ng-show="vm.data.length > 0">
        <li role="presentation">Avg PE {{ vm.data | weightedAverage:'PERatio':'MarketCapitalization' | number:2  }}</li>
        <li role="presentation">&nbsp;|Avg PEG {{ vm.data | weightedAverage:'PEGRatio':'MarketCapitalization' | number:2  }}</li>
        <li role="presentation">&nbsp;|Avg PB {{ vm.data | weightedAverage:'PriceBook':'MarketCapitalization' | number:2  }}</li>
        <li role="presentation">&nbsp;|Avg PS {{ vm.data | weightedAverage:'PriceSales':'MarketCapitalization' | number:2  }}</li>
        <li role="presentation">&nbsp;|Avg Div {{ vm.data | weightedAverage:'DividendYield':'MarketCapitalization' | number:2  }}</li>
        <li role="presentation">&nbsp;|Avg MACD50 {{ vm.data | weightedAverage:'PercentChangeFromFiftydayMovingAverage':'MarketCapitalization' | number:2  }}</li>
        <li role="presentation">&nbsp;|Avg MACD200 {{ vm.data | weightedAverage:'PercentChangeFromTwoHundreddayMovingAverage':'MarketCapitalization' | number:2  }}</li>
      </ul>
    </div>
    <div class="row animated fadeInUp">
        <div class="col-lg-10">
            <table class="animated fadeInDown table table-striped table-condensed header-fixed table-hover">
                <thead>
                    <tr>
                        <th>Symbol</th>

                        <!-- Volume -->
                        <th>Vol%</th>
                        <th>Change</th>
                        <th>Regress Pot.</th>

                        <th>Price</th>
                        <th>Close</th>

                        <!--Price comparison to long-term -->

                        <th ng-show="vm.isDetailed">Short</th>
                        <th ng-show="vm.isDetailed">Combined</th>
                        <th>Buffett</th>
                        <th ng-show="vm.isDetailed">EPS</th>
                        <th ng-show="vm.isDetailed">EPS^</th>

                        <!-- Equity -->
                        <th ng-show="vm.isDetailed">PB</th>
                        <th ng-show="vm.isDetailed">PS</th>
                        <!-- Earnings -->
                        <th ng-show="vm.isDetailed">PE</th>
                        <th ng-show="vm.isDetailed">PEG</th>
                        <th ng-show="vm.isDetailed">Dividend</th>
                        <th>Name</th>
                        <th>Trend Information</th>
                    </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="result in vm.data track by result.symbol" popover-placement="top" popover-trigger="click" popover="
                        <img height='300' width='600' src='http://finviz.com/chart.ashx?t={{result.symbol}}&ty=c&ta=1&p=d&s=l' style='vertical-align: middle !important;' />" >
                        <td>
                            <span class="label label-info">
                                <a ng-click='vm.openFinviz(result.symbol)'>{{ result.symbol + (result.MarketCapitalization ? " " + result.MarketCapitalization : "") }}</a>
                            </span>
                        </td>

                        <!-- Volume -->
                        <td>
                            <span ng-class="{
                                  'label-danger' : (result.Volume / result.AverageDailyVolume) * 100 < 50,
                                  'label-warning' : (result.Volume / result.AverageDailyVolume) * 100 >= 50 && (result.Volume / result.AverageDailyVolume) * 100 < 100,
                                  'label-success' : (result.Volume / result.AverageDailyVolume) * 100 > 100
                                  }" class="label">{{ (result.Volume / result.AverageDailyVolume) * 100 | number:0 }}%</span>
                        </td>

                        <td>
                            <span ng-class="{ 'label-danger' : ((result.LastTradePriceOnly / result.PreviousClose) -1) < 0,
                                  'label-warning' : ((result.LastTradePriceOnly / result.PreviousClose) -1) >= 0 && ((result.LastTradePriceOnly / result.PreviousClose) -1) <= (3.5/100),
                                  'label-success' : ((result.LastTradePriceOnly / result.PreviousClose) -1) > (3.5/100) }"
                                  class="label">{{ ((result.LastTradePriceOnly / result.PreviousClose) -1) * 100 | number:1 }}%</span>
                        </td>

                        <td>
                            <span ng-class="{ 'label-danger' :  ((result.YearHigh / result.LastTradePriceOnly) -1) < 0.07,
                                  'label-warning' : ((result.YearHigh / result.LastTradePriceOnly) -1) >= 0.07 && ((result.YearHigh / result.LastTradePriceOnly) -1) <= 0.2,
                                  'label-success' : ((result.YearHigh / result.LastTradePriceOnly) -1) > 0.2 }"
                                  class="label">
                                {{ ((result.YearHigh / result.LastTradePriceOnly) -1) * 100 | number:1  }} %
                            </span>
                        </td>


                        <td><a ng-click='vm.openGuru(result.symbol)'>{{ result.LastTradePriceOnly | currency}}</a></td>

                        <td>{{ result.PreviousClose }}</td>
                        <!--Price comparison to long-term -->

                        <td ng-show="vm.isDetailed">{{ result.ShortRatio }}</td>
                        <td ng-show="vm.isDetailed">
                            <span class="label label-info">
                                {{ vm.evaluateFundamentalData(result)| number:2 }}
                            </span>
                        </td>
                        <td>
                            <a ng-click='vm.openGuru(result.symbol)'>
                                <span ng-class="{ 'label-danger' :  (22.5 / (result.PriceBook * result.PERatio)) * 100 < 100,
                                  'label-warning' :(22.5 / (result.PriceBook * result.PERatio)) * 100 >= 100 && (22.5 / (result.PriceBook * result.PERatio)) * 100 <= 120,
                                  'label-success' : (22.5 / (result.PriceBook * result.PERatio)) * 100 > 120 }"
                                      class="label">
                                    {{ (22.5 / (result.PriceBook * result.PERatio)) * 100 | number:2 }}%
                                </span>
                            </a>
                        </td>
                        <td ng-show="vm.isDetailed">{{ result.EPSEstimateCurrentYear | number:2}}</td>
                        <td ng-show="vm.isDetailed">
                            <span ng-class="{ 'label-danger' :  ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 < 0,
                                  'label-warning' : ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 >= 0 && ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 <= 0.05,
                                  'label-success' : ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 > 0.5 }"
                                  class="label">
                                {{ ((result.EPSEstimateNextYear / result.EPSEstimateCurrentYear) -1) * 100 | number:2}}%
                            </span>
                        </td>

                        <!-- Equity -->
                        <td ng-show="vm.isDetailed">
                            <span class="label"
                                  ng-class="
                                              {
                                                'label-danger': result.PriceBook >= 4,
                                                'label-warning': result.PriceBook >= 2 && result.PriceBook < 4,
                                                'label-success': result.PriceBook <2
                                              }">{{ result.PriceBook }}</span>
                        </td>
                        <td ng-show="vm.isDetailed">
                            <span class="label"
                                  ng-class="
                                              {
                                              'label-info' : result.PriceSales == 0,
                                                'label-danger': result.PriceSales >= 4,
                                                'label-warning': result.PriceSales >= 2 && result.PriceSales < 4,
                                                'label-success': result.PriceSales <2 && result.PriceSales != 0
                                              }">{{ result.PriceSales }}</span>
                        </td>

                        <!-- Earnings -->
                        <td ng-show="vm.isDetailed">
                            <span class="label"
                                  ng-class="
                                              {
                                                'label-danger': result.PERatio > 19,
                                                'label-warning': result.PERatio > 12 && result.PEGRatio <= 19,
                                                'label-success': result.PERatio <=12
                                              }">{{ result.PERatio }}</span>
                        </td>
                        <td ng-show="vm.isDetailed">
                            <span class="label"
                                  ng-class="
                                              {
                                                'label-danger': result.PEGRatio > 1.75,
                                                'label-warning': result.PEGRatio > 1 && result.PEGRatio <= 1.75,
                                                'label-success': result.PEGRatio <=1 && result.PEGRatio != 0,
                                                'label-info' : result.PEGRatio == 0
                                              }">{{ result.PEGRatio }}</span>
                        </td>

                        <td ng-show="vm.isDetailed">
                            <span class="label" ng-class="{
                                              'label-info': result.DividendYield == 0,
                                              'label-danger': result.DividendYield > 0 && (result.DividendYield <=1.5 || result.DividendYield > 7),
                                              'label-warning': result.DividendYield > 1.5 && result.DividendYield < 4,
                                              'label-success': result.DividendYield >= 4 && result.DividendYield <= 7}">{{ result.DividendYield | number:2 }}</span>&nbsp;&nbsp;{{ vm.adjustDividendDate(result.ExDividendDate) }}
                        </td>
                        <td>{{ result.Name | limitTo: 25 }}</td>
                        <td>
                            <a ng-click='vm.openYahoo(result.symbol)'>
                                <span class="label" ng-class="vm.evaluateSeriesData(result).cssClass">
                                    {{
                                    (result.OneyrTargetPrice ? "(" + ((result.OneyrTargetPrice/ result.LastTradePriceOnly-1) * 100| number:0) + "% Target:" + result.OneyrTargetPrice + ", " : "(") +
                                    "MACD50:" + result.PercentChangeFromFiftydayMovingAverage   +") "
                                    + vm.evaluateSeriesData(result).text
                                    }}
                                </span>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="panel panel-default col-lg-3" style="z-index:1 !important;">
            <div class="animated fadeInUp well">
                <form class="form-search">
                    <div class="input-group">
                        <span for="tickerInput" class="input-group-btn" disabled="disabled">
                            <button type="submit" class="btn btn-link" disabled="">Ticker</button>
                        </span>
                        <input ng-enter="vm.add()"
                               ng-model="vm.input"
                               ng-focus=""
                               type="text"
                               auto-focus
                               id="tickerInput"
                               type="text"
                               class="form-control" />
                        <span class="input-group-btn">
                            <button type="submit" class="btn btn-success" ng-click="vm.add()">Add</button>
                        </span>
                    </div>
                </form>
            </div>
            <div class="animated fadeInDown panel-body">
                <button ng-show="vm.tickers.length > 0" class="btn btn-danger glyphicon glyphicon-trash" ng-click="vm.clear()">&nbsp;Delete-All</button>
                <ul class="list-group">
                    <li class="list-group-item" ng-repeat="t in vm.tickers">
                        <span class="btn" disabled="disabled">{{t | uppercase}}</span>
                        <button type="button" class="btn btn-warning glyphicon glyphicon-remove pull-right" ng-click="vm.removeTicker(t);"></button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
