<style>
    .label {
        vertical-align: middle !important;
    }

    .label-warning, .label-success, .label-danger, .label-info, .label-default {
        font-size: medium !important;
    }

    /*.label-info {
            font-size:small !important;
        }*/
</style>
<toaster-container toaster-options="{'time-out': 5000}"></toaster-container>
<div class="container-fixed">
  <div class="row" ng-cloak="">
    <div id="results" class="col-lg-12" style="z-index:1 !important;">
      <br />
      <div class="well">
        <div class="row">
          <div class="col-xs-6">
              <select class="form-control" ng-model="vm.selectedSource" ng-change="vm.handleDataSourceChange()"
                      title='Choose one of the following...'>
                  <option sly-repeat="item in vm.sources">{{item}}</option>
              </select>
          </div>
          <div class="col-xs-6">
            <label class="btn btn-info" ng-model="vm.isDetailed" btn-checkbox>Is Detailed View</label>
          </div>
        </div>
        <div class="row">
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active">Avg PE {{ vm.data | weightedAverageAll:'PERatio':'MarketCapitalization':'list' | number:2  }}</li>
            <li role="presentation">&nbsp;|Avg PEG {{ vm.data | weightedAverageAll:'PEGRatio':'MarketCapitalization':'list' | number:2  }}</li>
            <li role="presentation" class="active">&nbsp;|Avg PB {{ vm.data | weightedAverageAll:'PriceBook':'MarketCapitalization':'list' | number:2  }}</li>
            <li role="presentation">&nbsp;|Avg PS {{ vm.data | weightedAverageAll:'PriceSales':'MarketCapitalization':'list' | number:2  }}</li>
            <li role="presentation" class="active">&nbsp;|Avg Div {{ vm.data | weightedAverageAll:'DividendYield':'MarketCapitalization':'list' | number:2  }}</li>
            <li role="presentation">&nbsp;|Avg MA50 {{ vm.data | weightedAverageAll:'PercentChangeFromFiftydayMovingAverage':'MarketCapitalization':'list' | number:2  }}</li>
            <li role="presentation">&nbsp;|Avg MA200 {{ vm.data | weightedAverageAll:'PercentChangeFromTwoHundreddayMovingAverage':'MarketCapitalization':'list' | number:2  }}</li>
          </ul>
        </div>
      </div>
      <tabset type="pills">
        <tab ng-repeat="row in vm.data" heading="{{row.sector}}" ng-click="tabSwitch(row.sector)">
          <div class="row col-xs-12">
            <ul class="nav nav-tabs" role="tablist">
              <li role="presentation">Avg PE {{ row.list | weightedAverage:'PERatio':'MarketCapitalization' | number:2  }}</li>
              <li role="presentation">&nbsp;|Avg PEG {{ row.list | weightedAverage:'PEGRatio':'MarketCapitalization' | number:2  }}</li>
              <li role="presentation">&nbsp;|Avg PB {{ row.list | weightedAverage:'PriceBook':'MarketCapitalization' | number:2  }}</li>
              <li role="presentation">&nbsp;|Avg PS {{ row.list | weightedAverage:'PriceSales':'MarketCapitalization' | number:2  }}</li>
              <li role="presentation">&nbsp;|Avg Div {{ row.list | weightedAverage:'DividendYield':'MarketCapitalization' | number:2  }}</li>
              <li role="presentation">&nbsp;|Avg MA50 {{ row.list | weightedAverage:'PercentChangeFromFiftydayMovingAverage':'MarketCapitalization' | number:2  }}</li>
              <li role="presentation">&nbsp;|Avg MA200 {{ row.list | weightedAverage:'PercentChangeFromTwoHundreddayMovingAverage':'MarketCapitalization' | number:2  }}</li>
            </ul>
          </div>
          <div class="row col-xs-12">
          <div class="table-responsive">
            <table class="table table-striped table-condensed table-border header-fixed table-hover">
              <thead>
                <tr>
                  <th>Symbol</th>

                  <!-- Volume -->
                  <th>Vol%</th>
                  <th>Change</th>
                  <th>Regress Pot.</th>

                  <th>Price</th>
                  <th>Close</th>

                  <!--Price comparison to long-term -->

                  <th ng-if="vm.isDetailed">Short</th>
                  <th ng-if="vm.isDetailed">Combined</th>
                  <th>Buffett</th>
                  <th ng-if="vm.isDetailed">EPS</th>
                  <th ng-if="vm.isDetailed">EPS^</th>

                  <!-- Equity -->
                  <th ng-if="vm.isDetailed">PB</th>
                  <th ng-if="vm.isDetailed">PS</th>
                  <!-- Earnings -->
                  <th ng-if="vm.isDetailed">PE</th>
                  <th ng-if="vm.isDetailed">PEG</th>
                  <th ng-if="vm.isDetailed">Dividend</th>
                  <th>Name</th>
                  <th>Trend Information</th>
                </tr>
              </thead>
              <tbody>
                <tr 
                  sly-repeat="result in row.list" 
                  popover-placement="top" 
                  popover-trigger="hover click" 
                  popover="<img height='300' width='600' src='http://finviz.com/chart.ashx?t={{result.symbol}}&ty=c&ta=1&p=d&s=l' style='vertical-align: middle !important;' />" >
                  <td>
                    <span class="label label-info">
                      <a ng-click='vm.openFinviz(result.symbol)'>{{ result.symbol + (result.MarketCapitalization ? " " + result.MarketCapitalization : "") }}</a>
                    </span>
                  </td>
                  <td>
                    <span ng-class="{
                      'label-danger' : vm.getRelativeVolume(result) < 50,
                      'label-warning' : vm.getRelativeVolume(result) >= 50 && vm.getRelativeVolume(result) < 100,
                      'label-success' : vm.getRelativeVolume(result) > 100
                      }" 
                      class="label">{{ vm.getRelativeVolume(result) | number:0 }}%</span>
                  </td>
                  <td>
                    <span ng-class="{ 
                      'label-danger' : vm.getDailyPercentChange(result) < 0,
                      'label-warning' : vm.getDailyPercentChange(result) >= 0 && vm.getDailyPercentChange(result) <= (3.5),
                      'label-success' : vm.getDailyPercentChange(result) > (3.5) }"
                      class="label">{{ vm.getDailyPercentChange(result) | number:1 }}%</span>
                  </td>
                  <td>
                    <span ng-class="{ 
                      'label-danger' : vm.getRegressionPotential(result) < 7,
                      'label-warning' : vm.getRegressionPotential(result) >= 7 && vm.getRegressionPotential(result) <= 20,
                      'label-success' : vm.getRegressionPotential(result) > 20 }"
                          class="label">
                      {{ vm.getRegressionPotential(result) | number:1  }} %
                    </span>
                  </td>
                  <td><a ng-click='vm.openGuru(result.symbol)'>{{ result.LastTradePriceOnly | currency}}</a></td>
                  <td>{{ result.PreviousClose  | currency}}</td>
                  <td ng-if="vm.isDetailed">{{ result.ShortRatio }}</td>
                  <td ng-if="vm.isDetailed">
                    <span class="label label-info">
                      {{ vm.evaluateFundamentalData(result)| number:2 }}
                    </span>
                  </td>
                  <td>
                    <a ng-click='vm.openGuru(result.symbol)'>
                      <span ng-class="{ 
                        'label-danger' :  vm.getMungerBuffettRatio(result) < 100,
                        'label-warning' :vm.getMungerBuffettRatio(result) >= 100 && vm.getMungerBuffettRatio(result) <= 120,
                        'label-success' : vm.getMungerBuffettRatio(result) > 120 }"
                        class="label">
                        {{ vm.getMungerBuffettRatio(result) | number:2 }}%
                      </span>
                    </a>
                  </td>
                  <td ng-if="vm.isDetailed">{{ result.EPSEstimateCurrentYear | number:2}}</td>
                  <td ng-if="vm.isDetailed">
                    <span ng-class="{ 
                      'label-danger' :  vm.getEpsGrowth(result) < 0,
                      'label-warning' : vm.getEpsGrowth(result) >= 0 && vm.getEpsGrowth(result) <= 0.05,
                      'label-success' : vm.getEpsGrowth(result) > 0.5 }"
                      class="label">
                      {{ vm.getEpsGrowth(result) | number:2}}%
                    </span>
                  </td>

                  <!-- Equity -->
                  <td ng-if="vm.isDetailed">
                    <span 
                      class="label"
                      ng-class="
                      {
                        'label-danger': result.PriceBook >= 4,
                        'label-warning': result.PriceBook >= 2 && result.PriceBook < 4,
                        'label-success': result.PriceBook <2
                      }">{{ result.PriceBook }}</span>
                  </td>
                  <td ng-if="vm.isDetailed">
                    <span 
                      class="label"
                      ng-class="
                      {
                        'label-info' : result.PriceSales == 0,
                        'label-danger': result.PriceSales >= 4,
                        'label-warning': result.PriceSales >= 2 && result.PriceSales < 4,
                        'label-success': result.PriceSales <2 && result.PriceSales != 0
                      }">{{ result.PriceSales }}</span>
                  </td>

                  <!-- Earnings -->
                  <td ng-if="vm.isDetailed">
                    <span 
                      class="label"
                      ng-class="
                      {
                        'label-danger': result.PERatio > 19,
                        'label-warning': result.PERatio > 12 && result.PEGRatio <= 19,
                        'label-success': result.PERatio <=12
                      }">{{ result.PERatio }}</span>
                  </td>
                  <td ng-if="vm.isDetailed">
                    <span 
                      class="label"
                      ng-class="
                      {
                        'label-danger': result.PEGRatio > 1.75,
                        'label-warning': result.PEGRatio > 1 && result.PEGRatio <= 1.75,
                        'label-success': result.PEGRatio <=1 && result.PEGRatio != 0,
                        'label-info' : result.PEGRatio == 0
                      }">{{ result.PEGRatio }}</span>
                  </td>

                  <td ng-if="vm.isDetailed">
                    <span 
                      class="label" 
                      ng-class="{
                        'label-info': result.DividendYield == 0,
                        'label-danger': result.DividendYield > 0 && (result.DividendYield <=1.5 || result.DividendYield > 7),
                        'label-warning': result.DividendYield > 1.5 && result.DividendYield < 4,
                        'label-success': result.DividendYield >= 4 && result.DividendYield <= 7}">
                        {{ result.DividendYield | number:2 }}</span>&nbsp;&nbsp;{{ vm.adjustDividendDate(result.ExDividendDate) 
                      }}
                  </td>
                  <td>{{ result.Name | limitTo: 25 }}</td>
                  <td>
                    <a ng-click='vm.openYahoo(result.symbol)'>
                      <span class="label" ng-class="vm.evaluateSeriesData(result).cssClass">
                        {{ vm.MovingAvgMeaning(result)}}
                      </span>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          </div>
        </tab>
      </tabset>
    </div>
  </div>
</div>